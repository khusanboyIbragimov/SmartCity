"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _react = _interopRequireDefault(require("react"));

var _debounce = _interopRequireDefault(require("./debounce"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _typeof(obj) { if (typeof Symbol === "function" && typeof Symbol.iterator === "symbol") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }; } return _typeof(obj); }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

function _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === "object" || typeof call === "function")) { return call; } return _assertThisInitialized(self); }

function _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }

function _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }

function _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return self; }

var EventSpy =
/*#__PURE__*/
function (_React$Component) {
  _inherits(EventSpy, _React$Component);

  function EventSpy(props, context) {
    var _this;

    _classCallCheck(this, EventSpy);

    _this = _possibleConstructorReturn(this, _getPrototypeOf(EventSpy).call(this, props, context));

    _this.createDebouncer();

    _this.handleEvent = _this.handleEvent.bind(_assertThisInitialized(_assertThisInitialized(_this)));
    return _this;
  }

  _createClass(EventSpy, [{
    key: "createDebouncer",
    value: function createDebouncer() {
      var _this2 = this;

      this.debouncer = (0, _debounce.default)(function (event) {
        _this2.props.onEvent && _this2.props.onEvent(event);
      }, this.props.debounce);
    }
  }, {
    key: "componentDidMount",
    value: function componentDidMount() {
      var target = this.props.target;

      if (target) {
        target.addEventListener(this.props.name, this.handleEvent, {
          passive: true
        });
        this.handleEvent({
          target: target,
          type: this.props.name
        });
      }
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate(prevProps) {
      var prevName = prevProps.name,
          prevTarget = prevProps.target;
      var _this$props = this.props,
          name = _this$props.name,
          target = _this$props.target;

      if (target !== prevTarget || name !== prevName) {
        if (prevTarget) {
          prevTarget.removeEventListener(prevName, this.handleEvent);
        }

        if (target) {
          target.addEventListener(name, this.handleEvent, {
            passive: true
          });
          this.handleEvent({
            target: target,
            type: this.props.name
          });
        }
      }
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      var target = this.props.target;
      target && target.removeEventListener(this.props.name, this.handleEvent);
    }
  }, {
    key: "componentWillReceiveProps",
    value: function componentWillReceiveProps(_ref) {
      var nextDebounce = _ref.debounce;

      if (this.props.debounce !== nextDebounce) {
        this.createDebouncer();
      }
    }
  }, {
    key: "handleEvent",
    value: function handleEvent(event) {
      this.debouncer(event);
    }
  }, {
    key: "render",
    value: function render() {
      return false;
    }
  }]);

  return EventSpy;
}(_react.default.Component);

exports.default = EventSpy;
EventSpy.defaultProps = {
  debounce: 200
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9FdmVudFNweS5qcyJdLCJuYW1lcyI6WyJFdmVudFNweSIsInByb3BzIiwiY29udGV4dCIsImNyZWF0ZURlYm91bmNlciIsImhhbmRsZUV2ZW50IiwiYmluZCIsImRlYm91bmNlciIsImV2ZW50Iiwib25FdmVudCIsImRlYm91bmNlIiwidGFyZ2V0IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5hbWUiLCJwYXNzaXZlIiwidHlwZSIsInByZXZQcm9wcyIsInByZXZOYW1lIiwicHJldlRhcmdldCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJuZXh0RGVib3VuY2UiLCJSZWFjdCIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBRXFCQSxROzs7OztBQUNuQixvQkFBWUMsS0FBWixFQUFtQkMsT0FBbkIsRUFBNEI7QUFBQTs7QUFBQTs7QUFDMUIsa0ZBQU1ELEtBQU4sRUFBYUMsT0FBYjs7QUFFQSxVQUFLQyxlQUFMOztBQUVBLFVBQUtDLFdBQUwsR0FBbUIsTUFBS0EsV0FBTCxDQUFpQkMsSUFBakIsdURBQW5CO0FBTDBCO0FBTTNCOzs7O3NDQUVpQjtBQUFBOztBQUNoQixXQUFLQyxTQUFMLEdBQWlCLHVCQUFTLFVBQUFDLEtBQUssRUFBSTtBQUNqQyxRQUFBLE1BQUksQ0FBQ04sS0FBTCxDQUFXTyxPQUFYLElBQXNCLE1BQUksQ0FBQ1AsS0FBTCxDQUFXTyxPQUFYLENBQW1CRCxLQUFuQixDQUF0QjtBQUNELE9BRmdCLEVBRWQsS0FBS04sS0FBTCxDQUFXUSxRQUZHLENBQWpCO0FBR0Q7Ozt3Q0FFbUI7QUFBQSxVQUNWQyxNQURVLEdBQ0MsS0FBS1QsS0FETixDQUNWUyxNQURVOztBQUdsQixVQUFJQSxNQUFKLEVBQVk7QUFDVkEsUUFBQUEsTUFBTSxDQUFDQyxnQkFBUCxDQUF3QixLQUFLVixLQUFMLENBQVdXLElBQW5DLEVBQXlDLEtBQUtSLFdBQTlDLEVBQTJEO0FBQUVTLFVBQUFBLE9BQU8sRUFBRTtBQUFYLFNBQTNEO0FBQ0EsYUFBS1QsV0FBTCxDQUFpQjtBQUFFTSxVQUFBQSxNQUFNLEVBQU5BLE1BQUY7QUFBVUksVUFBQUEsSUFBSSxFQUFFLEtBQUtiLEtBQUwsQ0FBV1c7QUFBM0IsU0FBakI7QUFDRDtBQUNGOzs7dUNBRWtCRyxTLEVBQVc7QUFBQSxVQUNkQyxRQURjLEdBQ21CRCxTQURuQixDQUNwQkgsSUFEb0I7QUFBQSxVQUNJSyxVQURKLEdBQ21CRixTQURuQixDQUNKTCxNQURJO0FBQUEsd0JBRUgsS0FBS1QsS0FGRjtBQUFBLFVBRXBCVyxJQUZvQixlQUVwQkEsSUFGb0I7QUFBQSxVQUVkRixNQUZjLGVBRWRBLE1BRmM7O0FBSTVCLFVBQ0VBLE1BQU0sS0FBS08sVUFBWCxJQUNHTCxJQUFJLEtBQUtJLFFBRmQsRUFHRTtBQUNBLFlBQUlDLFVBQUosRUFBZ0I7QUFDZEEsVUFBQUEsVUFBVSxDQUFDQyxtQkFBWCxDQUErQkYsUUFBL0IsRUFBeUMsS0FBS1osV0FBOUM7QUFDRDs7QUFFRCxZQUFJTSxNQUFKLEVBQVk7QUFDVkEsVUFBQUEsTUFBTSxDQUFDQyxnQkFBUCxDQUF3QkMsSUFBeEIsRUFBOEIsS0FBS1IsV0FBbkMsRUFBZ0Q7QUFBRVMsWUFBQUEsT0FBTyxFQUFFO0FBQVgsV0FBaEQ7QUFDQSxlQUFLVCxXQUFMLENBQWlCO0FBQUVNLFlBQUFBLE1BQU0sRUFBTkEsTUFBRjtBQUFVSSxZQUFBQSxJQUFJLEVBQUUsS0FBS2IsS0FBTCxDQUFXVztBQUEzQixXQUFqQjtBQUNEO0FBQ0Y7QUFDRjs7OzJDQUVzQjtBQUFBLFVBQ2JGLE1BRGEsR0FDRixLQUFLVCxLQURILENBQ2JTLE1BRGE7QUFHckJBLE1BQUFBLE1BQU0sSUFBSUEsTUFBTSxDQUFDUSxtQkFBUCxDQUEyQixLQUFLakIsS0FBTCxDQUFXVyxJQUF0QyxFQUE0QyxLQUFLUixXQUFqRCxDQUFWO0FBQ0Q7OztvREFFcUQ7QUFBQSxVQUFoQmUsWUFBZ0IsUUFBMUJWLFFBQTBCOztBQUNwRCxVQUFJLEtBQUtSLEtBQUwsQ0FBV1EsUUFBWCxLQUF3QlUsWUFBNUIsRUFBMEM7QUFDeEMsYUFBS2hCLGVBQUw7QUFDRDtBQUNGOzs7Z0NBRVdJLEssRUFBTztBQUNqQixXQUFLRCxTQUFMLENBQWVDLEtBQWY7QUFDRDs7OzZCQUVRO0FBQ1AsYUFBTyxLQUFQO0FBQ0Q7Ozs7RUE3RG1DYSxlQUFNQyxTOzs7QUFnRTVDckIsUUFBUSxDQUFDc0IsWUFBVCxHQUF3QjtBQUN0QmIsRUFBQUEsUUFBUSxFQUFFO0FBRFksQ0FBeEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgZGVib3VuY2UgZnJvbSAnLi9kZWJvdW5jZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEV2ZW50U3B5IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMsIGNvbnRleHQpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG5cbiAgICB0aGlzLmNyZWF0ZURlYm91bmNlcigpO1xuXG4gICAgdGhpcy5oYW5kbGVFdmVudCA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNyZWF0ZURlYm91bmNlcigpIHtcbiAgICB0aGlzLmRlYm91bmNlciA9IGRlYm91bmNlKGV2ZW50ID0+IHtcbiAgICAgIHRoaXMucHJvcHMub25FdmVudCAmJiB0aGlzLnByb3BzLm9uRXZlbnQoZXZlbnQpO1xuICAgIH0sIHRoaXMucHJvcHMuZGVib3VuY2UpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3QgeyB0YXJnZXQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAodGFyZ2V0KSB7XG4gICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnByb3BzLm5hbWUsIHRoaXMuaGFuZGxlRXZlbnQsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIHRoaXMuaGFuZGxlRXZlbnQoeyB0YXJnZXQsIHR5cGU6IHRoaXMucHJvcHMubmFtZSB9KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUocHJldlByb3BzKSB7XG4gICAgY29uc3QgeyBuYW1lOiBwcmV2TmFtZSwgdGFyZ2V0OiBwcmV2VGFyZ2V0IH0gPSBwcmV2UHJvcHM7XG4gICAgY29uc3QgeyBuYW1lLCB0YXJnZXQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoXG4gICAgICB0YXJnZXQgIT09IHByZXZUYXJnZXRcbiAgICAgIHx8IG5hbWUgIT09IHByZXZOYW1lXG4gICAgKSB7XG4gICAgICBpZiAocHJldlRhcmdldCkge1xuICAgICAgICBwcmV2VGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIocHJldk5hbWUsIHRoaXMuaGFuZGxlRXZlbnQpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKG5hbWUsIHRoaXMuaGFuZGxlRXZlbnQsIHsgcGFzc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgdGhpcy5oYW5kbGVFdmVudCh7IHRhcmdldCwgdHlwZTogdGhpcy5wcm9wcy5uYW1lIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSB0aGlzLnByb3BzO1xuXG4gICAgdGFyZ2V0ICYmIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMucHJvcHMubmFtZSwgdGhpcy5oYW5kbGVFdmVudCk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHsgZGVib3VuY2U6IG5leHREZWJvdW5jZSB9KSB7XG4gICAgaWYgKHRoaXMucHJvcHMuZGVib3VuY2UgIT09IG5leHREZWJvdW5jZSkge1xuICAgICAgdGhpcy5jcmVhdGVEZWJvdW5jZXIoKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVFdmVudChldmVudCkge1xuICAgIHRoaXMuZGVib3VuY2VyKGV2ZW50KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuRXZlbnRTcHkuZGVmYXVsdFByb3BzID0ge1xuICBkZWJvdW5jZTogMjAwXG59O1xuIl19